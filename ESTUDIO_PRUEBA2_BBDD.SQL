-- EJERCICIO 1
SELECT
    CASE
    WHEN SUM(VENTA.PRECIO_VENTA) IS NULL THEN NVL(SUM(VENTA.PRECIO_VENTA), 0)
    ELSE SUM(VENTA.PRECIO_VENTA)
    END "SUMA_VENTAS",
    CASE 
    WHEN SUM(VENTA.PRECIO_VENTA) >= 50000000 THEN (VEND.SUELDO_BRUTO * 0.30)
    WHEN SUM(VENTA.PRECIO_VENTA) < 50000000 THEN (VEND.SUELDO_BRUTO * 0.15)
    WHEN NVL(SUM(VENTA.PRECIO_VENTA), 0) = 0 THEN 0
    END "MONTO_BONO",
    VEND.VENDEDOR_ID
FROM VENTA
FULL JOIN VENDEDOR VEND ON VEND.VENDEDOR_ID = VENTA.FK_VENDEDOR_ID
GROUP BY VEND.VENDEDOR_ID, VEND.SUELDO_BRUTO
ORDER BY VEND.VENDEDOR_ID ASC;

DECLARE
V_SUMA_VENTAS NUMBER(10);
V_MONTO_BONO NUMBER(10);
V_ID_EMPLEADO VENDEDOR.VENDEDOR_ID%TYPE;
CURSOR CUR_BONO_EMP IS
        SELECT
        CASE
        WHEN SUM(VENTA.PRECIO_VENTA) IS NULL THEN NVL(SUM(VENTA.PRECIO_VENTA), 0)
        ELSE SUM(VENTA.PRECIO_VENTA)
        END "SUMA_VENTAS",
        CASE 
        WHEN SUM(VENTA.PRECIO_VENTA) >= 50000000 THEN (VEND.SUELDO_BRUTO * 0.30)
        WHEN SUM(VENTA.PRECIO_VENTA) < 50000000 THEN (VEND.SUELDO_BRUTO * 0.15)
        WHEN NVL(SUM(VENTA.PRECIO_VENTA), 0) = 0 THEN 0
        END "MONTO_BONO",
        VEND.VENDEDOR_ID
    FROM VENTA
    FULL JOIN VENDEDOR VEND ON VEND.VENDEDOR_ID = VENTA.FK_VENDEDOR_ID
    GROUP BY VEND.VENDEDOR_ID, VEND.SUELDO_BRUTO
    ORDER BY VEND.VENDEDOR_ID ASC;
BEGIN
    
    OPEN CUR_BONO_EMP;
        LOOP
            FETCH CUR_BONO_EMP INTO V_SUMA_VENTAS, V_MONTO_BONO, V_ID_EMPLEADO;
            EXIT WHEN CUR_BONO_EMP%NOTFOUND;
            DBMS_OUTPUT.PUT_LINE(V_SUMA_VENTAS || ' ' || V_MONTO_BONO || ' ' || V_ID_EMPLEADO);
            INSERT INTO BONO_VENDEDOR VALUES (V_SUMA_VENTAS, V_MONTO_BONO, V_ID_EMPLEADO);
        END LOOP;
    CLOSE CUR_BONO_EMP;
END;

SELECT * FROM BONO_VENDEDOR ORDER BY FK_VENDEDOR_ID ASC;

-- EJERCICIO 2
